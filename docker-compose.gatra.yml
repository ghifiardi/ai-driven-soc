version: "3.8"

services:
  # GATRA-ADA: Detection Service
  gatra-soc:
    build:
      context: .
      dockerfile: Dockerfile.gatra
    container_name: gatra-ada-platform
    environment:
      - PORT=8081
      - MULTITENANT_CONFIG_PATH=/app/config/gatra_multitenant_config.json
      - JWT_SECRET=${GATRA_JWT_SECRET:-gatra-secure-token-2025}
      - TAA_SERVICE_URL=http://taa-service:8082
      - CRA_SERVICE_URL=http://cra-service:8083
    ports:
      - "8081:8081"
    volumes:
      - ./config:/app/config
      - ./logs:/app/logs
    restart: unless-stopped
    networks:
      - soc-network

  # TAA: Triage & Analysis Service
  taa-service:
    build:
      context: .
      dockerfile: Dockerfile.gatra
    container_name: gatra-taa
    command: python taa_service.py
    environment:
      - PORT=8082
    ports:
      - "8082:8082"
    networks:
      - soc-network

  # CRA: Containment & Response Service
  cra-service:
    build:
      context: .
      dockerfile: Dockerfile.gatra
    container_name: gatra-cra
    command: python cra_service.py
    environment:
      - PORT=8083
    ports:
      - "8083:8083"
    networks:
      - soc-network

  # Learning Service: Reinforcement Learning Feedback Loop
  learning-service:
    build:
      context: .
      dockerfile: Dockerfile.gatra
    container_name: gatra-learning
    command: python soc_learning_service.py
    environment:
      - PORT=8084
    ports:
      - "8084:8084"
    networks:
      - soc-network

  # Dashboard for full SOC visualization
  gatra-dashboard:
    image: python:3.11-slim
    container_name: gatra-viz
    working_dir: /app
    volumes:
      - ./:/app
    environment:
      - STREAMLIT_SERVER_PORT=8501
    ports:
      - "8501:8501"
    command: bash -c "pip install streamlit pandas matplotlib seaborn && python3 -m streamlit run enterprise_gatra_dashboard.py"
    depends_on:
      - gatra-soc
    networks:
      - soc-network

networks:
  soc-network:
    driver: bridge
